<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>linuxabc</title>
  <meta name="author" content="alfie chan">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="linuxabc"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="linuxabc" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">linuxabc</a></h1>
  <h2><a href="/">focus on security, network management and embeded OS</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-11-08T07:00:00.000Z"><a href="/2013/11/08/KVM-installation/">2013-11-8</a></time>
      
      
  
    <h1 class="title"><a href="/2013/11/08/KVM-installation/">在CentOS6.3中安装KVM</a></h1>
  

    </header>
    <div class="entry">
      
        <p>产品实验室服务器之前安装的是xen，kvm作为后起之秀也值得测试一下，于是将其中一台服务器格了，重装CentOS6和kvm。</p>
<p>服务器硬件：</p>
<ul>
<li>2 * Intel Xeon（支持虚拟化）</li>
<li>4 * broadcom千兆网卡</li>
<li>2 * SAS 300G硬盘</li>
</ul>
<h2>安装</h2>
<figure class="highlight"><pre><span class="preprocessor"># yum -y groupinstall Virtualization "Virtualization Client" \</span>
                      <span class="string">"Virtualization Platform"</span> \
                      <span class="string">"Virtualization Tools"</span>
<span class="preprocessor"># yum -y install libguestfs-tools</span>
</pre></figure>

<p>这种安装方式还是不够简洁，可以尝试以下方式：</p>
<figure class="highlight"><pre><span class="preprocessor"># yum -y install qemu-kvm libvirt python-virtinst bridge-utils</span>
<span class="preprocessor"># modprobe kvm</span>
<span class="preprocessor"># modprobe kvm_intel # if AMD, "kvm_amd"</span>
<span class="preprocessor"># /etc/init.d/libvirtd start</span>
</pre></figure>

<p>安装完之后需重启相关服务：</p>
<p><code># service libvirtd status</code></p>
<p>如果libvirtd没有启动，需要先启动messagebus和avahi-daemon</p>
<figure class="highlight"><pre><span class="preprocessor"># service messagebus start</span>
<span class="preprocessor"># service avahi-daemon start</span>
<span class="preprocessor"># service libvirtd start</span>
</pre></figure>

<p>至此，KVM的安装就结束了，非常简单。不过在生产环境中还需要考虑网络和存储，相对复杂一些，网络拓扑环境如下：</p>
<h2>网络</h2>
<ul>
<li>eth0/eth1做成bond0，通过br0与业务交换机（huawei S5328-1）相连</li>
<li>eth2/eth3做成bond1，通过br1与存储交换机（huawei S5328-2）相连</li>
</ul>
<p>以下是网络配置</p>
<h3>配置网卡</h3>
<figure class="highlight"><pre><span class="preprocessor"># cat ifcfg-eth2</span>
DEVICE=<span class="string">"eth2"</span>
TYPE=<span class="string">"Ethernet"</span>
BOOTPROTO=<span class="string">"none"</span>
ONBOOT=<span class="string">"yes"</span>
USERCTL=<span class="string">"no"</span>
MASTER=<span class="string">"bond1"</span>
SLAVE=<span class="string">"yes"</span>
NM_CONTROLLED=<span class="string">"no"</span>
</pre></figure>

<figure class="highlight"><pre><span class="preprocessor"># cat ifcfg-eth3</span>
DEVICE=<span class="string">"eth3"</span>
TYPE=<span class="string">"Ethernet"</span>
BOOTPROTO=<span class="string">"none"</span>
ONBOOT=<span class="string">"yes"</span>
USERCTL=<span class="string">"no"</span>
MASTER=<span class="string">"bond1"</span>
SLAVE=<span class="string">"yes"</span>
NM_CONTROLLED=<span class="string">"no"</span>
</pre></figure>

<h3>配置bonding</h3>
<figure class="highlight"><pre><span class="comment"># cat /etc/modprobe.d/bonding.conf </span>
<span class="title">alias</span> bond1 bonding
</pre></figure>

<p>假如没有/etc/modprobe.d/bonding.conf，就自己创建一个。</p>
<figure class="highlight"><pre><span class="comment"># lsmod | grep bonding</span>
<span class="title">bonding</span>               <span class="number">127060</span>  <span class="number">0</span> 
8021q                  <span class="number">25058</span>  <span class="number">1</span> bonding
ipv6                  <span class="number">322541</span>  <span class="number">78</span> bonding,ip6t_REJECT,nf_conntrack_ipv6,nf_defrag_ipv6
</pre></figure>

<p>假如bonding还没有加载，那就手工加载。</p>
<figure class="highlight"><pre><span class="comment"># modprobe bonding</span>

[root<span class="property">@RH2285</span>-<span class="number">4</span> network-scripts]<span class="comment"># cat ifcfg-bond1</span>
DEVICE=bond1
BRIDGE=br1
USERCTL=<span class="literal">no</span>
BOOTPROTO=none
ONBOOT=<span class="literal">yes</span>
NM_CONTROLLED=<span class="literal">no</span>
BONDING_OPTS=<span class="string">"mode=4 miimon=80"</span>
</pre></figure>

<h3>配置bridge</h3>
<figure class="highlight"><pre><span class="preprocessor"># cat ifcfg-br1</span>
DEVICE=<span class="string">"br1"</span>
TYPE=Bridge
ONBOOT=yes
BOOTPROTO=<span class="keyword">static</span>
IPADDR=<span class="number">192.168</span><span class="number">.55</span><span class="number">.232</span>
NETMASK=<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>
NETWORK=<span class="number">192.168</span><span class="number">.55</span><span class="number">.0</span>
NM_CONTROLLED=<span class="string">"no"</span>
</pre></figure>

<p>最后重启网络：</p>
<p><code># service network restart</code></p>
<h3>检查</h3>
<figure class="highlight"><pre># cat /proc/net/bonding/bond1
<span class="class">Ethernet</span> <span class="class">Channel</span> <span class="class">Bonding</span> <span class="class">Driver</span>: v3<span class="number">.6</span><span class="number">.0</span> (<span class="class">September</span> <span class="number">26</span>, <span class="number">2009</span>)

<span class="class">Bonding</span> <span class="class">Mode</span>: <span class="class">IEEE</span> <span class="number">802.3</span>ad <span class="class">Dynamic</span> link aggregation
<span class="class">Transmit</span> <span class="class">Hash</span> <span class="class">Policy</span>: layer2 (<span class="number">0</span>)
<span class="class">MII</span> <span class="class">Status</span>: up
<span class="class">MII</span> <span class="class">Polling</span> <span class="class">Interval</span> (ms): <span class="number">80</span>
<span class="class">Up</span> <span class="class">Delay</span> (ms): <span class="number">0</span>
<span class="class">Down</span> <span class="class">Delay</span> (ms): <span class="number">0</span>

<span class="number">802.3</span>ad info
<span class="class">LACP</span> <span class="method">rate:</span> slow
<span class="class">Aggregator</span> selection policy (ad_select): stable
<span class="class">Active</span> <span class="class">Aggregator</span> <span class="class">Info</span>:
        <span class="class">Aggregator</span> <span class="class">ID</span>: <span class="number">3</span>
        <span class="class">Number</span> of <span class="method">ports:</span> <span class="number">2</span>
        <span class="class">Actor</span> <span class="class">Key</span>: <span class="number">17</span>
        <span class="class">Partner</span> <span class="class">Key</span>: <span class="number">305</span>
        <span class="class">Partner</span> <span class="class">Mac</span> <span class="class">Address</span>: <span class="number">54</span>:<span class="number">89</span>:<span class="number">98</span>:<span class="number">73</span>:<span class="method">bb:</span><span class="number">07</span>

<span class="class">Slave</span> <span class="class">Interface</span>: eth2
<span class="class">MII</span> <span class="class">Status</span>: up
<span class="class">Speed</span>: <span class="number">1000</span> <span class="class">Mbps</span>
<span class="class">Duplex</span>: full
<span class="class">Link</span> <span class="class">Failure</span> <span class="class">Count</span>: <span class="number">0</span>
<span class="class">Permanent</span> <span class="class">HW</span> <span class="method">addr:</span> <span class="number">3</span><span class="method">c:</span><span class="method">d9:</span><span class="number">2</span><span class="method">b:</span><span class="method">fd:</span><span class="number">39</span>:f0
<span class="class">Aggregator</span> <span class="class">ID</span>: <span class="number">3</span>
<span class="class">Slave</span> queue <span class="class">ID</span>: <span class="number">0</span>

<span class="class">Slave</span> <span class="class">Interface</span>: eth3
<span class="class">MII</span> <span class="class">Status</span>: up
<span class="class">Speed</span>: <span class="number">1000</span> <span class="class">Mbps</span>
<span class="class">Duplex</span>: full
<span class="class">Link</span> <span class="class">Failure</span> <span class="class">Count</span>: <span class="number">0</span>
<span class="class">Permanent</span> <span class="class">HW</span> <span class="method">addr:</span> <span class="number">3</span><span class="method">c:</span><span class="method">d9:</span><span class="number">2</span><span class="method">b:</span><span class="method">fd:</span><span class="number">39</span>:f2
<span class="class">Aggregator</span> <span class="class">ID</span>: <span class="number">3</span>
<span class="class">Slave</span> queue <span class="class">ID</span>: <span class="number">0</span>
</pre></figure>

<figure class="highlight"><pre><span class="preprocessor"># ifconfig br1</span>
<span class="preprocessor"># brctl show</span>
</pre></figure>

<p>网络配置完成之后，可从其它机器ssh登录br1的ip地址，测试网络是否可正常工作。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-08-08T07:00:00.000Z"><a href="/2013/08/08/nginx-on-OpenBSD/">2013-08-8</a></time>
      
      
  
    <h1 class="title"><a href="/2013/08/08/nginx-on-OpenBSD/">nginx on OpenBSD</a></h1>
  

    </header>
    <div class="entry">
      
        <blockquote>
<p><strong>UPDATE</strong><br>原文针对OpenBSD4.9，现在已经是5.2了，有些内容重新做了修订。</p>
<p>Nginx(“engine x”)是一个高性能的HTTP和反向代理服务器，也是一个IMAP/POP3/SMTP 代理服务器 。Nginx 是由 Igor Sysoev 为俄罗斯访问量第二的Rambler.ru 站点开发的，它已经在该站点运行超过四年多了。Igor 将源代码以类BSD许可证的形式发布。自Nginx 发布四年来，Nginx已经因为它的稳定性、丰富的功能集、 示例配置文件和低系统资源的消耗而闻名了。目前国内各大门户网站已经部署了Nginx，如新浪、网易、腾讯等；国内几个重要的视频分享网站也部署了Nginx，如六房间、酷6等。</p>
</blockquote>
<p>经过几年的发展，nginx的市场占有率稳步上升，截至2013年，市场份额占有率为15.52%（netcraft统计），微软的IIS为16.69%。nginx不日即可超越IIS。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/08/08/nginx-on-OpenBSD/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-04-03T15:00:00.000Z"><a href="/2013/04/03/OpenVPN-on-OpenBSD/">2013-04-3</a></time>
      
      
  
    <h1 class="title"><a href="/2013/04/03/OpenVPN-on-OpenBSD/">OpenVPN on OpenBSD</a></h1>
  

    </header>
    <div class="entry">
      
        <p>2013-04-03添加topology subnet和ccd配置。<br>2013-02-14取消whichsslconf依赖。<br>2012-04-12初稿。<br>{: .info}</p>
<p>OpenVPN是近年来最火的VPN软件，它部署容易，使用简单，跟IPsec相比，它所缺少的只是积累和口碑，不过没关系，已经有越来越多的公司开始在生产环境中用OpenVPN来取代IPsec。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2013/04/03/OpenVPN-on-OpenBSD/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-12-22T04:30:00.000Z"><a href="/2012/12/22/upgrade-openbsd/">2012-12-22</a></time>
      
      
  
    <h1 class="title"><a href="/2012/12/22/upgrade-openbsd/">升级OpenBSD</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我目前的两台防火墙是OpenBSD4.9，需要升级到5.2。由于OpenBSD不支持跨版本升级，因此需要采用4.9-&gt;5.0-&gt;5.1-&gt;5.2这种逐步升级的方式。</p>
<p>下面步骤是官网推荐的upgrade by install kernel。</p>
<pre><code><span class="number">1.</span> <span class="preprocessor"># mkdir /backup</span>
<span class="number">2.</span> <span class="preprocessor"># mv /bsd.rd /backup/bsd.rd.50</span>
<span class="number">3.</span> <span class="preprocessor"># wget http://ftp.jaist.ac.jp/pub/OpenBSD/5.2/i386/bsd.rd</span>
<span class="number">4.</span> <span class="preprocessor"># shutdown -r now</span>
<span class="number">5.</span> 在boot的提示符中输入
&gt;bsd<span class="variable">.rd</span>
<span class="number">6.</span> 选择(U)pgrade
然后选择合适的sets，我只选择了
bsd<span class="variable">.rd</span>
bsd
base<span class="variable">.tgz</span>
comp52<span class="variable">.tgz</span>
man52<span class="variable">.tgz</span>
<span class="number">7.</span> <span class="preprocessor"># wget http://ftp.jaist.ac.jp/pub/OpenBSD/5.2/i386/etc52.tgz</span>
<span class="number">8.</span> <span class="preprocessor"># sysmerge -x /backup/etc52.tgz</span>
<span class="number">9.</span> <span class="preprocessor"># 最后是确认所有的配置文件是否正确</span>
<span class="number">10.</span> <span class="preprocessor"># shutdown -r now</span></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-10-03T15:00:00.000Z"><a href="/2012/10/03/use-iscsi-as-vm-storage-backend/">2012-10-3</a></time>
      
      
  
    <h1 class="title"><a href="/2012/10/03/use-iscsi-as-vm-storage-backend/">使用iSCSI作为VM的storage backend</a></h1>
  

    </header>
    <div class="entry">
      
        <p>iSCSI作为VM的storage backend也很流行，原因是iSCSI协议非常适合于小文件的读写，而且其对硬件设备几乎没有什么要求，只要IP可达即可。</p>
<p>在本文中，我们仍然以solaris11作为外置存储，不得不说，solaris11实在是太强悍了，ZFS，comstar，nfs都是存储必备的组件模块。</p>
<h1>iSCSI server</h1>
<p>iSCSI server安装在solaris11上，solaris11</p>
<h1>iSCSI client</h1>
<p>iSCSI client将安装在hypervisor上，本文以CentOS为例。</p>
<h2>安装iSCSI client</h2>
<p>[root@DL165-1 ~]# yum install iscsi-initiator-utils</p>
<h2>配置iSCSI client</h2>
<figure class="highlight"><pre>[root@DL165-<span class="number">1</span> ~]<span class="comment"># vim /etc/iscsi/iscsid.conf</span>
<span class="keyword">...</span>
node.session.auth.username = linuxabc
node.session.auth.password = <span class="number">123456</span>
discovery.sendtargets.auth.username = linuxabc
discovery.sendtargets.auth.password = <span class="number">123456</span>
<span class="keyword">...</span>
</pre></figure>

<h2>启动iSCSI服务</h2>
<figure class="highlight"><pre>[root<span class="variable">@DL165</span>-<span class="number">1</span> ~]<span class="comment"># /etc/init.d/iscsi start</span>
</pre></figure>

<h2>连接到iSCSI server</h2>
<figure class="highlight"><pre><span class="title">[</span><span class="comment">root@DL165</span>-<span class="comment">1</span> <span class="comment">~</span>]<span class="comment">#</span> <span class="comment">iscsiadm</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">discovery</span> <span class="literal">-</span><span class="comment">t</span> <span class="comment">sendtargets</span> <span class="literal">-</span><span class="comment">p</span> <span class="comment">192</span>.<span class="comment">168</span>.<span class="comment">55</span>.<span class="comment">120</span>
<span class="title">[</span><span class="comment">root@DL165</span>-<span class="comment">1</span> <span class="comment">~</span>]<span class="comment">#</span> <span class="comment">iscsiadm</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">node</span> <span class="literal">-</span><span class="comment">T</span> <span class="comment">iqn</span>.<span class="comment">2010</span>-<span class="comment">06</span>.<span class="comment">xen</span>-<span class="comment">sanhead:xen</span>-<span class="comment">alfie</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">login</span>
<span class="title">[</span><span class="comment">root@DL165</span>-<span class="comment">1</span> <span class="comment">~</span>]<span class="comment">#</span> <span class="comment">/etc/init</span>.<span class="comment">d/iscsi</span> <span class="comment">restart
</pre></figure>

<p>在xen dom0中执行<code>fdisk -l</code>就会看到系统中多出了一个块设备/dev/sdc，那正是ZFS storage上的iSCSI target。</p>
<figure class="highlight"><pre>[root@DL165-<span class="number">1</span> ~]<span class="comment"># fdisk -l</span>
<span class="keyword">...</span>
Disk /dev/sdc: <span class="number">8589</span> MB, <span class="number">8589934592</span> bytes
<span class="number">64</span> heads, <span class="number">32</span> sectors/track, <span class="number">8192</span> cylinders
Units = cylinders of <span class="number">2048</span> * <span class="number">512</span> = <span class="number">1048576</span> bytes

Disk /dev/sdc doesn<span class="string">'t contain a valid partition table
</pre></figure>

<p>最后在xen dom0机器上把domU配置文件的disk一行改成：</p>
<figure class="highlight"><pre><span class="setting">disk = <span class="value">[ <span class="string">"phy:/dev/sdc,xvda,w"</span> ]</span></span>
</pre></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-10-02T15:00:00.000Z"><a href="/2012/10/02/upgrade-xen-and-centos/">2012-10-2</a></time>
      
      
  
    <h1 class="title"><a href="/2012/10/02/upgrade-xen-and-centos/">CentOS5.6+xen3.4.3升级至CentOS5.8+xen3.4.4</a></h1>
  

    </header>
    <div class="entry">
      
        <p>去年使用gitco repos成功地在CentOS5.6上安装了xen 3.4.3，已经稳定地运行了一年。前段时间CentOS和xen都升级了，于是便有了下文。</p>
<h2>升级CentOS</h2>
<p>在升级之前为了稳妥起见，先备份相关的配置文件。</p>
<p>CentOS的升级很简单，就是<code>yum update</code>，然后重启，唯一需要注意的就是重启前需要调整<code>/boot/grub/menu.lst</code>中的启动顺序，因为升级后，CentOS默认的内核启动顺序是新版的kernel。</p>
<p>验证一下</p>
<figure class="highlight"><pre>[root<span class="variable">@DL165</span>-<span class="number">2</span> ~]<span class="comment"># cat /etc/redhat-release </span>
<span class="constant">CentOS</span> release <span class="number">5.8</span> (<span class="constant">Final</span>)
</pre></figure>

<h2>升级xen</h2>
<figure class="highlight"><pre>[root<span class="variable">@DL165</span>-<span class="number">2</span> ~]<span class="comment"># mv /etc/yum.repos.d/GITCO-xen3.4.3 backup</span>
[root<span class="variable">@DL165</span>-<span class="number">2</span> ~]<span class="comment"># wget http://www.gitco.de/xen3.4.4</span>
[root<span class="variable">@DL165</span>-<span class="number">2</span> ~]<span class="comment"># yum update xen</span>
</pre></figure>

<p>将从xen3.4.3升级至xen3.4.4，验证一下：</p>
<figure class="highlight"><pre>[root@<span class="type">DL165</span>-<span class="number">2</span> ~]# xm info
<span class="title">host</span>                   : <span class="type">DL165</span>-<span class="number">2</span>
<span class="title">release</span>                : <span class="number">2.6</span><span class="number">.18</span>-<span class="number">308.13</span><span class="number">.1</span>.el5xen
<span class="title">version</span>                : #<span class="number">1</span> <span class="type">SMP</span> <span class="type">Tue</span> <span class="type">Aug</span> <span class="number">21</span> <span class="number">17</span>:<span class="number">51</span>:<span class="number">21</span> <span class="type">EDT</span> <span class="number">2012</span>
<span class="title">machine</span>                : x86_64
<span class="title">nr_cpus</span>                : <span class="number">8</span>
<span class="title">nr_nodes</span>               : <span class="number">1</span>
<span class="title">cores_per_socket</span>       : <span class="number">4</span>
<span class="title">threads_per_core</span>       : <span class="number">1</span>
<span class="title">cpu_mhz</span>                : <span class="number">2693</span>
<span class="title">hw_caps</span>                : <span class="number">178</span>bf3ff:efd3fbff:<span class="number">00000000</span>:<span class="number">00000310</span>:<span class="number">00802001</span>:<span class="number">00000000</span>:<span class="number">000037</span>ff:<span class="number">00000000</span>
<span class="title">virt_caps</span>              : hvm
<span class="title">total_memory</span>           : <span class="number">8191</span>
<span class="title">free_memory</span>            : <span class="number">7579</span>
<span class="title">node_to_cpu</span>            : node0:<span class="number">0</span>-<span class="number">7</span>
<span class="title">node_to_memory</span>         : node0:<span class="number">7579</span>
<span class="title">xen_major</span>              : <span class="number">3</span>
<span class="title">xen_minor</span>              : <span class="number">4</span>
<span class="title">xen_extra</span>              : <span class="number">.4</span>
<span class="title">xen_caps</span>               : xen-<span class="number">3.0</span>-x86_64 xen-<span class="number">3.0</span>-x86_32p hvm-<span class="number">3.0</span>-x86_32 hvm-<span class="number">3.0</span>-x86_32p hvm-<span class="number">3.0</span>-x86_64 
<span class="title">xen_scheduler</span>          : credit
<span class="title">xen_pagesize</span>           : <span class="number">4096</span>
<span class="title">platform_params</span>        : virt_start=<span class="number">0xffff800000000000</span>
<span class="title">xen_changeset</span>          : unavailable
<span class="title">cc_compiler</span>            : gcc version <span class="number">4.1</span><span class="number">.2</span> <span class="number">20080704</span> (<span class="type">Red</span> <span class="type">Hat</span> <span class="number">4.1</span><span class="number">.2</span>-<span class="number">52</span>)
<span class="title">cc_compile_by</span>          : root
<span class="title">cc_compile_domain</span>      : gitco.tld
<span class="title">cc_compile_date</span>        : <span class="type">Mon</span> <span class="type">Jun</span> <span class="number">25</span> <span class="number">11</span>:<span class="number">29</span>:<span class="number">36</span> <span class="type">CEST</span> <span class="number">2012</span>

<span class="title">xend_config_format</span>     : <span class="number">4</span>
</pre></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-23T04:30:00.000Z"><a href="/2012/07/23/sinfor-tips/">2012-07-23</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/23/sinfor-tips/">深信服M5100S tips</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在某个项目中用到了深信服的M5100-S SSL VPN设备，而网上关于深信服设备的资料非常匮乏，因此我根据平时的积累，整理了一些资料和tips，以飨读者。</p>
<h2>SNMP</h2>
<p><strong>community</strong><br>在深信服的设备使用文档中从未提及SNMP，然而实际上是有SNMP这个功能的，只是community不是传统的<code>public</code>，而是<code>sinfors</code>。</p>
<p><strong>oid</strong></p>
<figure class="highlight"><pre><span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.0</span>    <span class="preprocessor"># 设备运行时间（UPTIME），以1/100秒为单位。</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span>    <span class="preprocessor"># 系统描述</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span><span class="number">.0</span>    <span class="preprocessor"># 设备型号</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span><span class="number">.0</span>    <span class="preprocessor"># 联系方式</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.6</span><span class="number">.0</span>    <span class="preprocessor"># 位置</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.0</span>    <span class="preprocessor"># 接口数量</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="variable">.x</span>     <span class="preprocessor"># 接口描述信息（不同的x数值代表不同的接口，视设备回复而定）</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.10</span><span class="variable">.x</span>    <span class="preprocessor"># 接口接收总流量，以Byte为单位（不同的x数值代表不同的接口，视设备回复而定）</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.11</span><span class="variable">.x</span>    <span class="preprocessor"># 接口发送总流量，以Byte为单位（不同的x数值代表不同的接口，视设备回复而定）</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.8</span><span class="variable">.x</span>     <span class="preprocessor"># 接口接口状态（1-up，2-down）（不同的x数值代表不同的接口，视设备回复而定）</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.5</span><span class="variable">.x</span>     <span class="preprocessor"># 接口速率，以10bps为单位（不同的x数值代表不同的接口，视设备回复而定）</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span>     <span class="preprocessor"># CPU占用率，以百分比为单位。</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.0</span>     <span class="preprocessor"># 设备类型(如M5000)</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.0</span>     <span class="preprocessor"># 剩余内存，free+buffers，以KB为单位。</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.0</span>     <span class="preprocessor"># VPN状态("vpn's status. 0 is stopped, 1 is normal, 2 is error" ) DLAN4.x版本因为lmdlan没有跟snmpagent程序通信，因此取不到正确的运行状态，会一直显示为1。</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.0</span>     <span class="preprocessor"># VPN连接数，DLAN4.x版本因为lmdlan没有跟snmpagent程序通信，因此取不到正确的连接数，会一直显示为0。</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.0</span>     <span class="preprocessor"># 软件版本(如M5000-Q-4.0-R1)</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.0</span>     <span class="preprocessor"># SSL VPN状态（"ssl's status. 0 is stopped, 1 is normal, 2 is error"）</span>
<span class="number">1.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.33333</span><span class="number">.1</span><span class="number">.3</span><span class="number">.2</span><span class="number">.0</span>     <span class="preprocessor"># SSL VPN连接数（即接入的用户数目）</span>
</pre></figure>

<p>实际上，在PRTG中，可以通过auto discovery扫描到端口带宽和uptime，至于CPU利用率、MEM剩余量则可以通过手工添加sensor。</p>
<h2>CLI</h2>
<p>M5100-S不支持命令行，但是作为一个网络工程师，对非CLI的设备心存反感，想ping一下互联设备，抓个包啥的都不行，好在深信服提供了一个update的工具，勉强可以使用。</p>
<p>按F10将弹出如下窗口，支持的命令包括</p>
<ol>
<li>ifconfig</li>
<li>netstat -rn</li>
<li>ping</li>
</ol>
<p>从显示结果来看，sinfor的OS应该是在linux上进行裁剪的，因为假如是BSD，网卡名称就应该是fxp或xx等以驱动来命名。<br>既然如此，根据GPL协议，sinfor是否应该开放源代码呢？</p>
<h2>dlan</h2>
<p>只要有这个工具，是否意味着任何一台sinfor设备，只要用户不修改原始密码，就可以从公网任意访问xx了呢？那安全性从何谈起。</p>
<h2>默认端口映射问题</h2>
<p>M5100-S通过一条互联网专线访问外网，运营商分配给该客户的是112.180.254.33/29网段的IP地址，其中112.180.254.34是M5100-S的接口IP地址。默认情况下，这几个IP地址的443端口全部映射到该接口IP的443端口，也就是说，当客户分别访问这几个IP的443端口时，全部重定向至<a href="https://112.180.254.34。" target="_blank">https://112.180.254.34。</a></p>
<p>难道，作为一个安全网络设备，不应该将：“非明确通过的即禁止”当作设计的首要原则吗？</p>
<p>解决的办法：</p>
<p>除了112.180.254.34这个IP外，明确禁止剩余IP的443端口映射。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-15T04:30:00.000Z"><a href="/2012/07/15/zabbix-tips/">2012-07-15</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/15/zabbix-tips/">zabbix tips</a></h1>
  

    </header>
    <div class="entry">
      
        <p>graph时间问题</p>
<p>graph的时间显示比系统时间快了8个小时，可通过以下操作修复：</p>
<ol>
<li>调整系统时区</li>
<li>hwclock —systohc</li>
<li>调整php.ini时区</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-15T04:30:00.000Z"><a href="/2012/07/15/serial-console-on-centos/">2012-07-15</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/15/serial-console-on-centos/">在CentOS中使用Serial console</a></h1>
  

    </header>
    <div class="entry">
      
        <p>手头上有一台HP ML110服务器，准备拿来当流控设备，安装完CentOS后发现机柜里面没有显示器，还得配置serial console，方便日后维护。</p>
<p>在网上搜了很多文档，都说国外的文档质量高，可是就serial console这个问题也折腾了我大半天，因此记下来以免忘记。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/07/15/serial-console-on-centos/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-04T04:30:00.000Z"><a href="/2012/07/04/migrate-from-vmware-server-to-virtualbox/">2012-07-4</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/04/migrate-from-vmware-server-to-virtualbox/">将VMware server迁移到VirtualBox</a></h1>
  

    </header>
    <div class="entry">
      
        <p>VMware GSX是VMware公司于200x年推出的一款企业级虚拟化产品，后来迫于VirtualBox的压力，VMware公司决定将其改名为VMware server，并免费提供给用户使用。2010年，VMware公司发布了臃肿迟缓的2.0版本，用户怨声载道，随后不久VMware公司便宣布终止更新该产品，并劝说用户迁移到VMware player。但是明眼人都知道，VMware公司并不愿意看到这个免费而优秀的产品，继续分流他们的客户，我甚至认为，VMware公司之所以推出错误百出的2.0版本是为了找一个冠冕堂皇的理由，将VMware server给埋了，这样对广大用户也有个交代，这一招实在是太狠了。<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2012/07/04/migrate-from-vmware-server-to-virtualbox/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:ioiioi.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/RouterOS/MikroTik/">MikroTik</a><small>2</small></li>
  
    <li><a href="/categories/RouterOS/">RouterOS</a><small>3</small></li>
  
    <li><a href="/categories/VPS/">VPS</a><small>1</small></li>
  
    <li><a href="/categories/confluence/">confluence</a><small>1</small></li>
  
    <li><a href="/categories/dhcp/debian/">debian</a><small>1</small></li>
  
    <li><a href="/categories/ldap/debian/">debian</a><small>1</small></li>
  
    <li><a href="/categories/debian/">debian</a><small>12</small></li>
  
    <li><a href="/categories/dhcp/">dhcp</a><small>1</small></li>
  
    <li><a href="/categories/ubuntu/domU/">domU</a><small>1</small></li>
  
    <li><a href="/categories/debian/domU/">domU</a><small>1</small></li>
  
    <li><a href="/categories/freebsd/">freebsd</a><small>1</small></li>
  
    <li><a href="/categories/iptable/">iptable</a><small>1</small></li>
  
    <li><a href="/categories/virtualization/iscsi/">iscsi</a><small>1</small></li>
  
    <li><a href="/categories/xen/kvm/">kvm</a><small>1</small></li>
  
    <li><a href="/categories/kvm/">kvm</a><small>1</small></li>
  
    <li><a href="/categories/ldap/">ldap</a><small>1</small></li>
  
    <li><a href="/categories/network/ldap/">ldap</a><small>1</small></li>
  
    <li><a href="/categories/openwrt/linksys/">linksys</a><small>1</small></li>
  
    <li><a href="/categories/linux/">linux</a><small>1</small></li>
  
    <li><a href="/categories/linux/netbsd/">netbsd</a><small>1</small></li>
  
    <li><a href="/categories/openbsd/netmgmt/">netmgmt</a><small>1</small></li>
  
    <li><a href="/categories/network/">network</a><small>3</small></li>
  
    <li><a href="/categories/debian/network/">network</a><small>2</small></li>
  
    <li><a href="/categories/networking/">networking</a><small>1</small></li>
  
    <li><a href="/categories/nexenta/">nexenta</a><small>4</small></li>
  
    <li><a href="/categories/octopress/">octopress</a><small>3</small></li>
  
    <li><a href="/categories/debian/octopress/">octopress</a><small>2</small></li>
  
    <li><a href="/categories/openSUSE/">openSUSE</a><small>2</small></li>
  
    <li><a href="/categories/openbsd/">openbsd</a><small>8</small></li>
  
    <li><a href="/categories/openbsd openntpd/">openbsd openntpd</a><small>1</small></li>
  
    <li><a href="/categories/openwrt/">openwrt</a><small>1</small></li>
  
    <li><a href="/categories/others/">others</a><small>1</small></li>
  
    <li><a href="/categories/linux/netbsd/solaris/">solaris</a><small>1</small></li>
  
    <li><a href="/categories/ubuntu/">ubuntu</a><small>1</small></li>
  
    <li><a href="/categories/vim/">vim</a><small>1</small></li>
  
    <li><a href="/categories/debian/virtualbox/">virtualbox</a><small>1</small></li>
  
    <li><a href="/categories/virtualbox/">virtualbox</a><small>5</small></li>
  
    <li><a href="/categories/windows/virtualbox/">virtualbox</a><small>1</small></li>
  
    <li><a href="/categories/virtualization/">virtualization</a><small>2</small></li>
  
    <li><a href="/categories/kvm/virtualization/">virtualization</a><small>1</small></li>
  
    <li><a href="/categories/vpn/">vpn</a><small>1</small></li>
  
    <li><a href="/categories/windows/">windows</a><small>1</small></li>
  
    <li><a href="/categories/virtualization/xen/">xen</a><small>1</small></li>
  
    <li><a href="/categories/debian/domU/xen/">xen</a><small>1</small></li>
  
    <li><a href="/categories/xen/">xen</a><small>2</small></li>
  
    <li><a href="/categories/ubuntu/domU/xen/">xen</a><small>1</small></li>
  
    <li><a href="/categories/xen/kvm/虚拟化/">虚拟化</a><small>1</small></li>
  
  </ul>
</div>


  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 alfie chan
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>